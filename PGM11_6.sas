/* Insomnia data*/
data francom;
 input case treat time outcome ;
  if outcome=1 then do; y1=1; y2=0; y3=0; y4=0; end;
  else if outcome=2 then do; y1=0; y2=1; y3=0; y4=0; end;
  else if outcome=3 then do; y1=0; y2=0; y3=1; y4=0; end;
  else if outcome=4 then do; y1=0; y2=0; y3=0; y4=1 ;end;
cards;
        1       1     0        1   7
        1       1     1        1   7
        2       1     0        1   7
        2       1     1        1   7
        3       1     0        1   7
        3       1     1        1   7
        4       1     0        1   7
        4       1     1        1   7
        5       1     0        1   7
        5       1     1        1   7
        6       1     0        1   7
        6       1     1        1   7
        7       1     0        1   7
        7       1     1        1   7
        8       1     0        1   4
        8       1     1        2   4
        9       1     0        1   4
        9       1     1        2   4
       10       1     0        1   4
       10       1     1        2   4
       11       1     0        1   4
       11       1     1        2   4
       12       1     0        1   1
       12       1     1        3   1
       13       1     0        2  11
       13       1     1        1  11
       14       1     0        2  11
       14       1     1        1  11
       15       1     0        2  11
       15       1     1        1  11
       16       1     0        2  11
       16       1     1        1  11
       17       1     0        2  11
       17       1     1        1  11
       18       1     0        2  11
       18       1     1        1  11
       19       1     0        2  11
       19       1     1        1  11
       20       1     0        2  11
       20       1     1        1  11
       21       1     0        2  11
       21       1     1        1  11
       22       1     0        2  11
       22       1     1        1  11
       23       1     0        2  11
       23       1     1        1  11
       24       1     0        2   5
       24       1     1        2   5
       25       1     0        2   5
       25       1     1        2   5
       26       1     0        2   5
       26       1     1        2   5
       27       1     0        2   5
       27       1     1        2   5
       28       1     0        2   5
       28       1     1        2   5
       29       1     0        2   2
       29       1     1        3   2
       30       1     0        2   2
       30       1     1        3   2
       31       1     0        2   2
       31       1     1        4   2
       32       1     0        2   2
       32       1     1        4   2
       33       1     0        3  13
       33       1     1        1  13
       34       1     0        3  13
       34       1     1        1  13
       35       1     0        3  13
       35       1     1        1  13
       36       1     0        3  13
       36       1     1        1  13
       37       1     0        3  13
       37       1     1        1  13
       38       1     0        3  13
       38       1     1        1  13
       39       1     0        3  13
       39       1     1        1  13
       40       1     0        3  13
       40       1     1        1  13
       41       1     0        3  13
       41       1     1        1  13
       42       1     0        3  13
       42       1     1        1  13
       43       1     0        3  13
       43       1     1        1  13
       44       1     0        3  13
       44       1     1        1  13
       45       1     0        3  13
       45       1     1        1  13
       46       1     0        3  23
       46       1     1        2  23
       47       1     0        3  23
       47       1     1        2  23
       48       1     0        3  23
       48       1     1        2  23
       49       1     0        3  23
       49       1     1        2  23
       50       1     0        3  23
       50       1     1        2  23
       51       1     0        3  23
       51       1     1        2  23
       52       1     0        3  23
       52       1     1        2  23
       53       1     0        3  23
       53       1     1        2  23
       54       1     0        3  23
       54       1     1        2  23
       55       1     0        3  23
       55       1     1        2  23
       56       1     0        3  23
       56       1     1        2  23
       57       1     0        3  23
       57       1     1        2  23
       58       1     0        3  23
       58       1     1        2  23
       59       1     0        3  23
       59       1     1        2  23
       60       1     0        3  23
       60       1     1        2  23
       61       1     0        3  23
       61       1     1        2  23
       62       1     0        3  23
       62       1     1        2  23
       63       1     0        3  23
       63       1     1        2  23
       64       1     0        3  23
       64       1     1        2  23
       65       1     0        3  23
       65       1     1        2  23
       66       1     0        3  23
       66       1     1        2  23
       67       1     0        3  23
       67       1     1        2  23
       68       1     0        3  23
       68       1     1        2  23
       69       1     0        3   3
       69       1     1        3   3
       70       1     0        3   3
       70       1     1        3   3
       71       1     0        3   3
       71       1     1        3   3
       72       1     0        3   1
       72       1     1        4   1
       73       1     0        4   9
       73       1     1        1   9
       74       1     0        4   9
       74       1     1        1   9
       75       1     0        4   9
       75       1     1        1   9
       76       1     0        4   9
       76       1     1        1   9
       77       1     0        4   9
       77       1     1        1   9
       78       1     0        4   9
       78       1     1        1   9
       79       1     0        4   9
       79       1     1        1   9
       80       1     0        4   9
       80       1     1        1   9
       81       1     0        4   9
       81       1     1        1   9
       82       1     0        4  17
       82       1     1        2  17
       83       1     0        4  17
       83       1     1        2  17
       84       1     0        4  17
       84       1     1        2  17
       85       1     0        4  17
       85       1     1        2  17
       86       1     0        4  17
       86       1     1        2  17
       87       1     0        4  17
       87       1     1        2  17
       88       1     0        4  17
       88       1     1        2  17
       89       1     0        4  17
       89       1     1        2  17
       90       1     0        4  17
       90       1     1        2  17
       91       1     0        4  17
       91       1     1        2  17
       92       1     0        4  17
       92       1     1        2  17
       93       1     0        4  17
       93       1     1        2  17
       94       1     0        4  17
       94       1     1        2  17
       95       1     0        4  17
       95       1     1        2  17
       96       1     0        4  17
       96       1     1        2  17
       97       1     0        4  17
       97       1     1        2  17
       98       1     0        4  17
       98       1     1        2  17
       99       1     0        4  13
       99       1     1        3  13
      100       1     0        4  13
      100       1     1        3  13
      101       1     0        4  13
      101       1     1        3  13
      102       1     0        4  13
      102       1     1        3  13
      103       1     0        4  13
      103       1     1        3  13
      104       1     0        4  13
      104       1     1        3  13
      105       1     0        4  13
      105       1     1        3  13
      106       1     0        4  13
      106       1     1        3  13
      107       1     0        4  13
      107       1     1        3  13
      108       1     0        4  13
      108       1     1        3  13
      109       1     0        4  13
      109       1     1        3  13
      110       1     0        4  13
      110       1     1        3  13
      111       1     0        4  13
      111       1     1        3  13
      112       1     0        4   8
      112       1     1        4   8
      113       1     0        4   8
      113       1     1        4   8
      114       1     0        4   8
      114       1     1        4   8
      115       1     0        4   8
      115       1     1        4   8
      116       1     0        4   8
      116       1     1        4   8
      117       1     0        4   8
      117       1     1        4   8
      118       1     0        4   8
      118       1     1        4   8
      119       1     0        4   8
      119       1     1        4   8
      120       0     0        1   7
      120       0     1        1   7
      121       0     0        1   7
      121       0     1        1   7
      122       0     0        1   7
      122       0     1        1   7
      123       0     0        1   7
      123       0     1        1   7
      124       0     0        1   7
      124       0     1        1   7
      125       0     0        1   7
      125       0     1        1   7
      126       0     0        1   7
      126       0     1        1   7
      128       0     0        1   4
      128       0     1        2   4
      129       0     0        1   4
      129       0     1        2   4
      130       0     0        1   4
      130       0     1        2   4
      131       0     0        1   4
      131       0     1        2   4
      132       0     0        1   2
      132       0     1        3   2
      133       0     0        1   2
      133       0     1        3   2
      134       0     0        1   1
      134       0     1        4   1
      135       0     0        2  14
      135       0     1        1  14
      136       0     0        2  14
      136       0     1        1  14
      137       0     0        2  14
      137       0     1        1  14
      138       0     0        2  14
      138       0     1        1  14
      139       0     0        2  14
      139       0     1        1  14
      140       0     0        2  14
      140       0     1        1  14
      141       0     0        2  14
      141       0     1        1  14
      142       0     0        2  14
      142       0     1        1  14
      143       0     0        2  14
      143       0     1        1  14
      144       0     0        2  14
      144       0     1        1  14
      145       0     0        2  14
      145       0     1        1  14
      146       0     0        2  14
      146       0     1        1  14
      147       0     0        2  14
      147       0     1        1  14
      148       0     0        2  14
      148       0     1        1  14
      149       0     0        2   5
      149       0     1        2   5
      150       0     0        2   5
      150       0     1        2   5
      151       0     0        2   5
      151       0     1        2   5
      152       0     0        2   5
      152       0     1        2   5
      153       0     0        2   5
      153       0     1        2   5
      154       0     0        2   1
      154       0     1        3   1
      155       0     0        3   6
      155       0     1        1   6
      156       0     0        3   6
      156       0     1        1   6
      157       0     0        3   6
      157       0     1        1   6
      158       0     0        3   6
      158       0     1        1   6
      159       0     0        3   6
      159       0     1        1   6
      160       0     0        3   6
      160       0     1        1   6
      161       0     0        3   9
      161       0     1        2   9
      162       0     0        3   9
      162       0     1        2   9
      163       0     0        3   9
      163       0     1        2   9
      164       0     0        3   9
      164       0     1        2   9
      165       0     0        3   9
      165       0     1        2   9
      166       0     0        3   9
      166       0     1        2   9
      167       0     0        3   9
      167       0     1        2   9
      168       0     0        3   9
      168       0     1        2   9
      169       0     0        3   9
      169       0     1        2   9
      170       0     0        3  18
      170       0     1        3  18
      171       0     0        3  18
      171       0     1        3  18
      172       0     0        3  18
      172       0     1        3  18
      173       0     0        3  18
      173       0     1        3  18
      174       0     0        3  18
      174       0     1        3  18
      175       0     0        3  18
      175       0     1        3  18
      176       0     0        3  18
      176       0     1        3  18
      177       0     0        3  18
      177       0     1        3  18
      178       0     0        3  18
      178       0     1        3  18
      179       0     0        3  18
      179       0     1        3  18
      180       0     0        3  18
      180       0     1        3  18
      181       0     0        3  18
      181       0     1        3  18
      182       0     0        3  18
      182       0     1        3  18
      183       0     0        3  18
      183       0     1        3  18
      184       0     0        3  18
      184       0     1        3  18
      185       0     0        3  18
      185       0     1        3  18
      186       0     0        3  18
      186       0     1        3  18
      187       0     0        3  18
      187       0     1        3  18
      188       0     0        3   2
      188       0     1        4   2
      189       0     0        3   2
      189       0     1        4   2
      190       0     0        4   4
      190       0     1        1   4
      191       0     0        4   4
      191       0     1        1   4
      192       0     0        4   4
      192       0     1        1   4
      193       0     0        4   4
      193       0     1        1   4
      194       0     0        4  11
      194       0     1        2  11
      195       0     0        4  11
      195       0     1        2  11
      196       0     0        4  11
      196       0     1        2  11
      197       0     0        4  11
      197       0     1        2  11
      198       0     0        4  11
      198       0     1        2  11
      199       0     0        4  11
      199       0     1        2  11
      200       0     0        4  11
      200       0     1        2  11
      201       0     0        4  11
      201       0     1        2  11
      202       0     0        4  11
      202       0     1        2  11
      203       0     0        4  11
      203       0     1        2  11
      204       0     0        4  11
      204       0     1        2  11
      205       0     0        4  14
      205       0     1        3  14
      206       0     0        4  14
      206       0     1        3  14
      207       0     0        4  14
      207       0     1        3  14
      208       0     0        4  14
      208       0     1        3  14
      209       0     0        4  14
      209       0     1        3  14
      210       0     0        4  14
      210       0     1        3  14
      211       0     0        4  14
      211       0     1        3  14
      212       0     0        4  14
      212       0     1        3  14
      213       0     0        4  14
      213       0     1        3  14
      214       0     0        4  14
      214       0     1        3  14
      215       0     0        4  14
      215       0     1        3  14
      216       0     0        4  14
      216       0     1        3  14
      217       0     0        4  14
      217       0     1        3  14
      218       0     0        4  14
      218       0     1        3  14
      219       0     0        4  22
      219       0     1        4  22
      220       0     0        4  22
      220       0     1        4  22
      221       0     0        4  22
      221       0     1        4  22
      222       0     0        4  22
      222       0     1        4  22
      223       0     0        4  22
      223       0     1        4  22
      224       0     0        4  22
      224       0     1        4  22
      225       0     0        4  22
      225       0     1        4  22
      226       0     0        4  22
      226       0     1        4  22
      227       0     0        4  22
      227       0     1        4  22
      228       0     0        4  22
      228       0     1        4  22
      229       0     0        4  22
      229       0     1        4  22
      230       0     0        4  22
      230       0     1        4  22
      231       0     0        4  22
      231       0     1        4  22
      232       0     0        4  22
      232       0     1        4  22
      233       0     0        4  22
      233       0     1        4  22
      234       0     0        4  22
      234       0     1        4  22
      235       0     0        4  22
      235       0     1        4  22
      236       0     0        4  22
      236       0     1        4  22
      237       0     0        4  22
      237       0     1        4  22
      238       0     0        4  22
      238       0     1        4  22
      239       0     0        4  22
      239       0     1        4  22
      127       0     0        4  22
      127       0     1        4  22
;
  
/*Marginal model GEE*/
proc genmod data=francom;  
  class case;
  model outcome = treat time treat*time / dist=multinomial link=clogit;
  repeated subject=case / type=indep corrw;
run;

proc nlmixed  data=francom qpoints=30 ;    
  bounds i2 > 0;  bounds i3 > 0;
  eta1 = i1 + treat*beta1 + time*beta2 + treat*time*beta3 + u;
  eta2 = i1 + i2 + treat*beta1 + time*beta2 + treat*time*beta3 + u;
  eta3 = i1 + i2 + i3 + treat*beta1 + time*beta2 + treat*time*beta3 + u;
  p1 = exp(eta1)/(1 + exp(eta1));
  p2 = exp(eta2)/(1 + exp(eta2)) - exp(eta1)/(1 + exp(eta1));
  p3 = exp(eta3)/(1 + exp(eta3)) - exp(eta2)/(1 + exp(eta2));
  p4 = 1 - exp(eta3)/(1 + exp(eta3));
  ll = y1*log(p1) + y2*log(p2) + y3*log(p3) + y4*log(p4);
  model y1 ~ general(ll);
  estimate 'interc2' i1+i2; * this is alpha_2 in model, and i1 is alpha_1;
  estimate 'interc3' i1+i2+i3;  * this is alpha_3 in model;
  random u ~ normal(0, sigma) subject=case;
run;
